@page "/battle"
@using BlazorAppBattle.Algorithms
@using BlazorAppBattle.Components

<PageTitle>Code Clash: Battle of Algorithms</PageTitle>

@if(bubbleSort is not null)
{
    <h1>Bubble Sort</h1>

    <Numbers Array="bubbleSort.Array" 
             PrimaryIndex="bubbleSort.Index"
             SecondaryIndex="bubbleSort.Index + 1"
             HighlightFrom="bubbleSort.Array.Length - bubbleSort.SortedCount"
             HighlightTo="bubbleSort.Array.Length - 1"
             IsSorted="bubbleSort.IsSorted"
             Rank="bubbleSort.Rank"
             />
}

@if (selectionSort is not null)
{
    <h1>Selection Sort</h1>

    <Numbers Array="selectionSort.Array"
             PrimaryIndex="selectionSort.CurrentIndex"
             SecondaryIndex="selectionSort.ElementIndex"
             HighlightFrom="0"
             HighlightTo="selectionSort.CurrentIndex - 1"
             IsSorted="selectionSort.IsSorted"
             Rank="selectionSort.Rank" />

    <p class="fs-1 text-muted">Minimum: @selectionSort.Array[selectionSort.MinIndex]</p>
}

@if (insertionSort is not null)
{
    <h1>Insertion Sort</h1>

    <Numbers Array="insertionSort.Array"
             PrimaryIndex="insertionSort.CurrentIndex"
             SecondaryIndex="insertionSort.PlacementIndex"
             HighlightFrom="0"
             HighlightTo="insertionSort.CurrentIndex - 1"
             IsSorted="insertionSort.IsSorted"
             Rank="insertionSort.Rank" />

    <p class="fs-1 text-muted">Number: @insertionSort.Number</p>
}



@if (quickSort is not null)
{
    <h1>QuickSort Sort</h1>

    <Numbers Array="quickSort.Array"
             PrimaryIndex="quickSort.CurrentIndex"
             SecondaryIndex="quickSort.SmallerElementIndex"
             HighlightFrom="quickSort.Low"
             HighlightTo="quickSort.High"
             IsSorted="quickSort.IsSorted"
             Rank="quickSort.Rank" />

    <p class="fs-1 text-muted">Pivot: @quickSort.Pivot</p>
    <p class ="fs-1 text-muted">Partitions:
        @foreach(var partition in quickSort.Partitions)
        {
            <Text>(@partition.low : @partition.high) </Text>
        }
    </p>
}

<button class="btn btn-primary" @onclick="NextIteration">Next Iteration</button>

@code {
    int rank = 1;
    BubbleSort? bubbleSort;
    SelectionSort? selectionSort;
    InsertionSort? insertionSort;
    QuickSort? quickSort;

    protected override void OnInitialized()
    {
        int[] array = Tools.Generate(20, 20);

        bubbleSort = new BubbleSort(array.ToArray());    
        selectionSort = new SelectionSort(array.ToArray());
        insertionSort = new InsertionSort(array.ToArray());
        quickSort = new QuickSort(array.ToArray());
    }

    private void NextIteration()
    {
        bool incrementRank = false;

        if(bubbleSort is not null)
        {
            bubbleSort.NextIteration();

            if (bubbleSort.IsSorted == true && bubbleSort.Rank == 0)
            {
                bubbleSort.Rank = rank;

                incrementRank = true;
            }
        }

        if (selectionSort is not null)
        {
            selectionSort.NextIteration();

            if (selectionSort.IsSorted == true && selectionSort.Rank == 0)
            {
                selectionSort.Rank = rank;

                incrementRank = true;
            }
        }

        if (insertionSort is not null)
        {
            insertionSort.NextIteration();

            if (insertionSort.IsSorted == true && insertionSort.Rank == 0)
            {
                insertionSort.Rank = rank;

                incrementRank = true;
            }
        }

        if (quickSort is not null)
        {
            quickSort.NextIteration();

            if (quickSort.IsSorted == true && quickSort.Rank == 0)
            {
                quickSort.Rank = rank;

                incrementRank = true;
            }
        }

        if(incrementRank)
        {
            ++rank;
        }

    }
}
